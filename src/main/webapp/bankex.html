<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BANKEX</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" />
  <style>
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
      background-color: black;
      color: #fff;
      font-size: 25px;
      margin-right: 10px;
    }

    header {
      background-color:#1a1a1a;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      height: 30px;
      font-size: 25px;
      font-weight: 400;
      margin-bottom: 10px;
    }

    #stockChart {
      width: 100%;
      height: 710px;
      display: block;
      background: #1a1a1a;
      border: 1px solid #aaa;
      margin-top: 10px;
      cursor: pointer;
    }

  button {
  margin: 4px;
  padding: 8px 16px;
  background: #1a1a1a;
  color: white;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
  transition: background 0.3s;
}

.buttons {
  display: flex;
  justify-content: center;
  gap: 10px;
  margin-top: 20px;
  margin-bottom: 30px;
}


button:hover {
  background: #333;
}

button.active {
  background: #3e5eff !important;
}


    #tooltip {
      position: absolute;
      background: #222;
      color: white;
      padding: 6px 10px;
      border-radius: 4px;
      font-size: 12px;
      pointer-events: none;
      display: none;
      border: 1px solid #444;
    }

    header > div:last-child {
  display: flex;
  align-items: center;
  gap: 15px;
}

body .bod{
  margin-left: 10px;
  margin-top: 10px;
  margin-bottom: 10px;
  font-weight: 400;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
  text-align: center;
}


  </style>
</head>
<body>

<header>
  <div>
    <i class="fab fa-bitcoin" style="margin-right: 10px;"></i>COINSTOCKS
  </div>
  <div style="display: flex; align-items: center; gap: 15px;">
    <div id="clock">--:--:--</div>
  </div>
</header>
<div class ="bod"></i>BANKEX Chart</div>
<canvas id="stockChart"></canvas>
<div id="tooltip"></div>


<script>
  const canvas = document.getElementById('stockChart');
  const ctx = canvas.getContext('2d');
  const tooltip = document.getElementById('tooltip');
  let currentData = [];
  let prices = [], dates = [];

  const MARKET_OPEN_HOUR = 9;
  const MARKET_OPEN_MIN = 30;
  const MARKET_CLOSE_HOUR = 23;
  let lastDateString = "";

  function isMarketOpen(now) {
    const hours = now.getHours();
    const mins = now.getMinutes();
    const openTime = new Date(now); openTime.setHours(MARKET_OPEN_HOUR, MARKET_OPEN_MIN, 0, 0);
    const closeTime = new Date(now); closeTime.setHours(MARKET_CLOSE_HOUR, 0, 0, 0);
    return now >= openTime && now <= closeTime;
  }

  function generateLiveDataPoint() {
	  const now = new Date();

	  const dateStr = now.toDateString();
	  if (lastDateString !== dateStr) {
	    prices = [];
	    dates = [];
	    lastDateString = dateStr;
	  }

	  if (!isMarketOpen(now)) {
	    draw(prices, dates, true); // pass flag to draw message
	    return;
	  }

	  const base = 175.30;
	  const trend = Math.sin(prices.length / 5) * 5;
	  const noise = Math.random() * 10;
	  const price = base + trend + noise;
	  prices.push(price);
	  dates.push(now);

	  draw(prices, dates, false);
	}

  function draw(pricesToShow, datesToShow, marketClosed = false) {
	  canvas.width = canvas.clientWidth;
	  canvas.height = canvas.clientHeight;
	  ctx.clearRect(0, 0, canvas.width, canvas.height);

	  const w = canvas.width, h = canvas.height, padding = 50;

	  // If market is closed, just show the message
	  if (marketClosed) {
	    ctx.fillStyle = 'rgba(0,0,0,0.7)';
	    ctx.fillRect(0, 0, w, h); // dark overlay

	    ctx.fillStyle = 'white';
	    ctx.textAlign = 'center';
	    ctx.font = '20px system-ui';
	    ctx.fillText("The market is closed.", w / 2, h / 2 - 10);

	    ctx.font = '16px system-ui';
	    ctx.fillText(`Come back at ${MARKET_OPEN_HOUR.toString().padStart(2, '0')}:${MARKET_OPEN_MIN.toString().padStart(2, '0')} AM`, w / 2, h / 2 + 20);
	    return;
	  }

	  if (pricesToShow.length < 2) return;

	  const max = Math.max(...pricesToShow);
	  const min = Math.min(...pricesToShow);
	  const range = max - min;

	  // Y-Axis
	  ctx.fillStyle = '#888';
	  ctx.textAlign = 'right';
	  ctx.font = '12px system-ui';
	  for (let i = 0; i <= 5; i++) {
	    const y = padding + ((h - 2 * padding) / 5) * i;
	    const price = (max - (range / 5) * i).toFixed(2);
	    ctx.fillText(`₹${price}`, padding - 10, y + 4);
	    ctx.strokeStyle = '#333';
	    ctx.beginPath(); ctx.moveTo(padding, y); ctx.lineTo(w - padding, y); ctx.stroke();
	  }

	  // X-Axis
	  ctx.textAlign = 'center';
	  const labelCount = 6;
	  const used = new Set();
	  for (let i = 0; i < labelCount; i++) {
	    const index = Math.floor(i * (datesToShow.length - 1) / (labelCount - 1));
	    const x = padding + (index / (datesToShow.length - 1)) * (w - 2 * padding);
	    const label = datesToShow[index].toLocaleTimeString('en-IN', {
	      hour: '2-digit', minute: '2-digit', hour12: true
	    });
	    if (!used.has(label)) {
	      ctx.fillText(label, x, h - padding + 20);
	      used.add(label);
	    }
	  }

	  // Line Chart
	  ctx.strokeStyle = 'lime';
	  ctx.beginPath();
	  currentData = [];
	  pricesToShow.forEach((price, i) => {
	    const x = padding + (i / (pricesToShow.length - 1)) * (w - 2 * padding);
	    const y = h - padding - ((price - min) / range) * (h - 2 * padding);
	    currentData.push({ x, y, price: price.toFixed(2) });
	    if (i === 0) ctx.moveTo(x, y); else ctx.lineTo(x, y);
	  });
	  ctx.stroke();
	}

  canvas.addEventListener('mousemove', (e) => {
    const rect = canvas.getBoundingClientRect();
    const mouseX = e.clientX - rect.left;
    const mouseY = e.clientY - rect.top;
    for (const point of currentData) {
      if (Math.abs(mouseX - point.x) < 5 && Math.abs(mouseY - point.y) < 5) {
        tooltip.style.left = e.pageX + 10 + 'px';
        tooltip.style.top = e.pageY + 10 + 'px';
        tooltip.innerText = `₹${point.price}`;
        tooltip.style.display = 'block';
        return;
      }
    }
    tooltip.style.display = 'none';
  });

  function updateClock() {
    const now = new Date();
    const timeString = now.toLocaleTimeString('en-IN', {
      hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true
    });
    document.getElementById('clock').innerText = timeString;
  }

  setInterval(() => {
    updateClock();
    generateLiveDataPoint();
  }, 3000); // update every 3 seconds

  updateClock();
  generateLiveDataPoint();
</script>


</body>
</html>
